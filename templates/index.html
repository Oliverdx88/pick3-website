<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pick3 Predictions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://js.stripe.com/v3"></script>
    <style>
      body { font-family: system-ui, Arial; max-width: 800px; margin: 40px auto; padding: 0 16px; }
      .plans { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
      .plan { border: 2px solid #e0e0e0; padding: 20px; border-radius: 8px; flex: 1; min-width: 200px; text-align: center; }
      .plan.free { border-color: #4CAF50; }
      .plan.vip { border-color: #2196F3; }
      .plan.yearly { border-color: #FF9800; }
      button { padding: 12px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 4px; width: 100%; margin-top: 10px; }
      .btn-free { background: #4CAF50; color: white; }
      .btn-vip { background: #2196F3; color: white; }
      .btn-yearly { background: #FF9800; color: white; }
      .user-status { background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
      .vip-features { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 20px; }
    </style>
  </head>
  <body>
    <h1>🎯 Pick3 Predictions</h1>
    
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #856404;">
        <strong>⚠️ Important Notice:</strong> This is a prediction system, not a guarantee of winning. Use responsibly. 
        Lottery games are games of chance and past results do not guarantee future outcomes.
    </div>
    
    <!-- Promotion Banner -->
    <div style="text-align: center; margin-bottom: 25px;">
        <script type="text/javascript" src="https://js.masteraffiliates.eu/javascript.php?prefix=pfYVvXLmaX_0eSuOMyVq0WNd7ZgqdRLk&media=463&campaign=1"></script>
    </div>
    
    {% if user %}
      <div class="user-status">
        <p>Signed in as <strong>{{ user.email or user['email'] }}</strong> — 
           <a href="/account">Account</a> — 
           <a href="/logout">Log out</a>
        </p>
        {% if user.status in ['active','trialing'] and user.plan in ['vip_monthly','vip_yearly'] %}
          <h3>🎉 Welcome VIP!</h3>
          <p>You're subscribed to <strong>VIP Pro</strong> - enjoy full access to all features!</p>
          <p><a href="/predict" style="background: #2196F3; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; display: inline-block; margin: 10px 0;">🎯 Generate Predictions</a></p>
          <p><a href="/api/v1/smartscore">Try SmartScore API</a></p>
        {% elif user.plan == 'free' %}
          <h3>🟢 Free Starter Active</h3>
          <p>You're on the free plan. Generate doubles predictions or upgrade to VIP for full features!</p>
          <p><a href="/predict" style="background: #4CAF50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; display: inline-block; margin: 10px 0;">🎯 Generate Predictions</a></p>
        {% else %}
          <h3>🎯 Welcome to Pick 3 Predictions!</h3>
          <p>You're signed in! Start generating predictions or choose a plan below.</p>
          <p><a href="/predict" style="background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; display: inline-block; margin: 10px 0;">🎯 Generate Predictions (Free)</a></p>
        {% endif %}
      </div>
    {% else %}
      <div class="user-status">
        <p><a href="/login">Sign in</a> to access your account and generate predictions</p>
        <p><a href="/predict" style="background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; display: inline-block; margin: 10px 0;">🎯 Try Predictions (Login Required)</a></p>
      </div>
    {% endif %}
    
    <p>Choose your plan to access our advanced Pick 3 prediction system.</p>
    
    <div class="plans">
      <div class="plan free">
        <h3>🟢 Free Starter</h3>
        <p><strong>$0/month</strong></p>
        <p>Generate doubles predictions using our AI system. Choose state and number of predictions. Perfect for getting started.</p>
        <button class="btn-free" onclick="subscribe('free')">Get Free Access</button>
      </div>
      
      <div class="plan vip">
        <h3>🔵 VIP Pro</h3>
        <p><strong>$9.99/month</strong></p>
        <p>Unlock doubles + singles predictions, multiple states, advanced AI analysis, and unlimited generations per day.</p>
        
        <div style="background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; border-radius: 8px; margin: 15px 0;">
          <h4 style="color: #2e7d32; margin-top: 0;">🆕 NEW: PICK 3 HYBRID SYSTEM</h4>
          <p style="margin: 8px 0; color: #2e7d32; font-size: 0.9em;">
            <strong>Single & Double Pro:</strong> Advanced hybrid analysis combining singles and doubles for maximum coverage
          </p>
          <p style="margin: 8px 0; color: #2e7d32; font-size: 0.9em;">
            <strong>Double & Single Pair Grouper:</strong> Intelligent pairing system that groups complementary numbers for optimal play strategies
          </p>
        </div>
        
        <button class="btn-vip" onclick="subscribe('vip_monthly')">Join VIP Monthly</button>
      </div>
      
      <div class="plan yearly">
        <h3>🟡 VIP Pro Yearly</h3>
        <p><strong>$99/year</strong></p>
        <p><strong>Best Value!</strong> Get 12 months for the price of 10. All VIP features included. Save $20!</p>
        <button class="btn-yearly" onclick="subscribe('vip_yearly')">Join VIP Yearly</button>
      </div>
    </div>
    
    <div class="vip-features">
      <h4>🔵 VIP Features Include:</h4>
      <ul>
        <li>Generate doubles + singles predictions</li>
        <li>Multiple states (NJ, NY, PA, CA, FL, GA, TX)</li>
        <li>Pick 3 game type</li>
        <li>Unlimited daily generations</li>
        <li>Advanced AI analysis</li>
        <li>Last draw context and timing</li>
        <li><strong>🆕 Pick 3 Hybrid System (Single & Double Pro)</strong></li>
        <li><strong>🆕 Double & Single Pair Grouper</strong></li>
        <li>Ad-free experience</li>
      </ul>
    </div>
    
    <p><a href="/privacy">Privacy</a> • <a href="/terms">Terms</a></p>

    <script>
      let stripe;
      
      // Initialize Stripe when the page loads
      document.addEventListener('DOMContentLoaded', function() {
        const publishableKey = "{{ publishable_key }}";
        if (publishableKey && publishableKey !== "") {
          stripe = Stripe(publishableKey);
        } else {
          console.error("Stripe publishable key not configured");
        }
      });
      
      async function subscribe(plan) {
        if (!stripe) {
          alert("Payment system is not available. Please contact support or try again later.");
          return;
        }
        
        const res = await fetch(`/create-checkout-session/${plan}`, { method: "POST" });
        const data = await res.json();
        if (data.id) {
          const r = await stripe.redirectToCheckout({ sessionId: data.id });
          if (r.error) alert(r.error.message);
        } else {
          alert(data.error || "Error creating checkout session");
        }
      }
    </script>
  </body>
</html>